# اپلیکیشن نقاشی با React JS

این یک اپلیکیشن نقاشی ساده مبتنی بر وب است که با **React** ساخته شده است. این اپلیکیشن یک canvas فراهم می‌کند که می‌توانن در آن اشکال هندسی پایه را اضافه، جابجا و حذف کنند. ویژگی‌های کلیدی شامل قابلیت نام‌گذاری نقاشی، شمارش تعداد اشکال استفاده شده، و خروجی گرفتن (export) یا import کردن کل نقاشی به عنوان یک فایل **JSON** است. وضعیت (state) برنامه به صورت متمرکز با استفاده از Context API در React مدیریت می‌شود.

## ویژگی‌ها

  * **ابزارهای شکل**: از یک جعبه ابزار حاوی **دایره**، **مربع** و **مثلث** برای افزودن به بوم انتخاب میکنیم.
  * **افزودن اشکال با کلیک**: پس از انتخاب یک ابزار از نوار کناری (sidebar)، با کلیک در هر جای بوم، شکل انتخاب شده در صفحه نقاشی اضافه می‌شود.
  * **افزودن اشکال با کشیدن و رها کردن (Drag-and-Drop)**: یک شکل را از نوار کنار میکشیم و روی بوم رها میکنیم تا یک شکل جدید در آن مکان ایجاد شود.
  * **حذف اشکال**: با دو بار کلیک بر روی هر شکل در بوم، آن شکل حذف خواهد شد.
  * **عنوان برای نقاشی**: یک ورودی متنی در هدر به ما امکان می‌دهد نقاشی خود را نام‌گذاری کنیم، که این نام همچنین به عنوان نام فایل برای خروجی‌ها استفاده می‌شود.
  * **خروجی گرفتن/Import کردن (Export/Import)**:
      * **خروجی**: کل نقاشی، شامل عنوان و تمام اشکال با ویژگی‌هایشان را در یک فایل `.json` ذخیره میکنیم.
      * **Import کردن**: یک فایل `.json` که قبلاً ذخیره شده است را برای بازیابی وضعیت برنامه بارگذاری میکنیم.
  * **شمارش اشکال**: فوتر (footer) تعداد هر نوع شکل موجود در بوم را به صورت زنده نمایش می‌دهد و با افزودن یا حذف اشکال به طور خودکار به‌روز می‌شود.
  * **چیدمان Responsive**: چیدمان برنامه با استفاده از CSS Flexbox ساخته شده است که به مل امکان می‌دهد با اندازه‌های مختلف صفحه نمایش سازگار شود.

-----

## ساختار پروژه

کد برنامه به صورت کامپوننت‌ها، یک context برای مدیریت وضعیت، و فایل‌های CSS برای استایل‌دهی ساختار دهی شده است. این تفکیک مسئولیت‌ها (separation of concerns) باعث می‌شود که کد ما ماژولار و قابل نگهداری‌ باشد.

```
src/
|-- components/
|   |-- Canvas.js        # ناحیه اصلی نقاشی.
|   |-- Footer.js        # نمایش تعداد اشکال.
|   |-- Header.js        # شامل عنوان و دکمه‌های export/import.
|   |-- Shape.js         # رندر کردن اشکال مجزا (دایره، مربع، مثلث).
|   |-- Sidebar.js       # جعبه ابزار برای انتخاب اشکال.
|-- context/
|   |-- AppContext.js    # مدیریت وضعیت کلی با استفاده از React Context.
|-- App.css              # استایل‌شیت اصلی برای چیدمان و کامپوننت‌های برنامه.
|-- App.js               
|-- index.css            
|-- index.js             # نقطه ورود برنامه React.
```

-----

## تشریح کامپوننت‌ها

### `App`

کامپوننت اصلی `App` به عنوان ریشه برنامه عمل می‌کند. مسئولیت اصلی آن ساختاردهی چیدمان کلی با مونتاژ کامپوننت‌های `Header`، `Canvas`، `Sidebar` و `Footer` است. این کامپوننت کل درخت کامپوننت‌ها را در `AppProvider` می‌پیچد تا وضعیت و اکشن‌های سراسری برای تمام کامپوننت‌های تو در تو در دسترس باشد.

### `Header`

کامپوننت `Header` عنوان نقاشی را نمایش می‌دهد و قابلیت واردات/صادرات را فراهم می‌کند.

  * **عنوان نقاشی**: یک فیلد `<input type="text">` به `drawingName` از state در context متصل شده است. رویداد `onChange` تابع `setDrawingName` را برای به‌روزرسانی عنوان به صورت زنده فراخوانی می‌کند.
  * **دکمه Export**: کنترل‌کننده `onClick` دکمه "Export"، تابع `handleExport` را از context فراخوانی می‌کند. این تابع یک رشته JSON از `drawingName` و `shapesOnCanvas` فعلی ایجاد کرده، آن را در یک URL داده (data URL) می‌پیچد و به صورت برنامه‌ریزی شده روی یک عنصر موقت `<a>` کلیک می‌کند تا دانلود آغاز شود.
  * **دکمه Import**: برای جلوگیری از نمایش یک عنصر ورودی فایل، دکمه "Import" از `useRef` برای کلیک برنامه‌ریزی شده روی یک `<input type="file">` مخفی استفاده می‌کند. هنگامی که یک فایل انتخاب می‌شود، رویداد `onChange` روی ورودی فایل، تابع `handleImport` را از context فراخوانی می‌کند که فایل JSON را می‌خواند، آن را تجزیه (parse) می‌کند و وضعیت برنامه را به‌روز می‌کند.

### `Sidebar`

`Sidebar` شامل ابزارهای شکلی است که کاربر می‌تواند انتخاب یا بکشد.

  * **انتخاب ابزار**: هر ابزار شکل یک `<div>` با یک کنترل‌کننده `onClick` است که `setSelectedShapeTool` را از context فراخوانی کرده و `selectedShapeTool` را در state به‌روز می‌کند. ابزار انتخاب شده فعلی یک کلاس CSS به نام 'selected' برای بازخورد بصری دریافت می‌کند.
  * **کشیدن و رها کردن (Drag and Drop)**: ابزارهای شکل با تنظیم ویژگی `draggable="true"` قابل کشیدن می‌شوند. کنترل‌کننده رویداد `onDragStart` تابع `handleDragStart` را فراخوانی می‌کند که از متد `event.dataTransfer.setData()` برای ذخیره شناسه شکل (مانند "circle") با یک شناسه نوع منحصر به فرد استفاده می‌کند. این به `Canvas` اجازه می‌دهد تا آیتم رها شده را شناسایی کند.

### `Canvas`

`Canvas` ناحیه تعاملی است که اشکال در آن رندر و دستکاری می‌شوند.

  * **افزودن اشکال (کلیک)**: کنترل‌کننده `onClick` برای `<div>` اصلی بوم، `handleCanvasClickInternal`، بررسی می‌کند که آیا یک ابزار شکل انتخاب شده است یا نه و سپس مختصات `x` و `y` کلیک را نسبت به بوم محاسبه می‌کند. سپس تابع `addShapeToCanvasOnClick` را از context برای ایجاد یک شکل جدید فراخوانی می‌کند.
  * **افزودن اشکال (رها کردن)**: کنترل‌کننده `onDrop`، `handleDrop`، شناسه شکل را از متد `event.dataTransfer.getData()` بازیابی می‌کند. سپس مختصات محل رها کردن را محاسبه کرده و تابع `addShapeFromDrop` از context را برای افزودن شکل جدید به بوم فراخوانی می‌کند. رویداد `onDragOver` نیز برای جلوگیری از رفتار پیش‌فرض مرورگر و ارائه بازخورد بصری (کلاس `drag-over`) مدیریت می‌شود.
  * **حذف اشکال**: کامپوننت `Canvas` روی آرایه `shapesOnCanvas` پیمایش (map) کرده و برای هر کدام یک کامپوننت `Shape` رندر می‌کند. این کامپوننت تابع `removeShapeFromCanvas` را از context مستقیماً به prop `onDoubleClick` کامپوننت `Shape` ارسال می‌کند.

### `Footer`

`Footer` تعداد کل هر نوع شکل را نمایش می‌دهد. این کامپوننت شیء `shapeCounts` را از `AppContext` مصرف می‌کند. این شیء به طور کارآمد در context با استفاده از هوک `useMemo` محاسبه می‌شود، که تضمین می‌کند شمارش فقط زمانی که آرایه `shapesOnCanvas` تغییر می‌کند دوباره محاسبه شود.

### `Shape`

این کامپوننت مسئول رندر کردن یک شکل هندسی مجزا بر اساس propهایی است که دریافت می‌کند (`id`, `type`, `x`, `y`).

  * از **استایل‌های درون‌خطی (inline styles)** برای موقعیت‌یابی (`position: 'absolute'`, `left`, `top`) استفاده می‌کند.
  * هندسه و رنگ شکل توسط prop `type` تعیین می‌شود. به عنوان مثال، یک `'circle'` یک `borderRadius: '50%'` دریافت می‌کند، در حالی که یک `'triangle'` با استفاده از بردرهای CSS ایجاد می‌شود.
  * دابل کلیک روی `div` شکل، تابع `onDoubleClick` را که از `Canvas` به آن پاس داده شده است، فعال می‌کند، که در نهایت `removeShapeFromCanvas` را از context برای حذف شکل فراخوانی می‌کند.

-----

## استایل‌دهی با `App.css`

ظاهر و حس برنامه در `App.css` تعریف شده است، که از **CSS Flexbox** برای ایجاد یک چیدمان واکنش‌گرا و ساختاریافته استفاده می‌کند.

  * **چیدمان کلی**: کلاس `.app-container` یک کانتینر flex عمودی ایجاد می‌کند و برنامه را به یک هدر، یک ناحیه محتوای اصلی و یک فوتر سازماندهی می‌کند. سپس کلاس `.main-content` از یک چیدمان flex افقی برای قرار دادن `.canvas-area` و `.app-sidebar` در کنار هم استفاده می‌کند. ویژگی `flex-grow: 1` روی محتوای اصلی و بوم استفاده می‌شود تا اطمینان حاصل شود که فضای موجود را پر می‌کنند.
  * **استایل‌دهی کامپوننت**: هر کامپوننت اصلی مجموعه‌ای از استایل‌های خاص خود را دارد. به عنوان مثال، `.app-header`، `.app-footer` و `.app-sidebar` دارای رنگ‌های پس‌زمینه و بردرهای مشخصی برای جداسازی بصری آن‌ها هستند.
  * **وضعیت‌های تعاملی**: CSS بازخورد بصری برای تعاملات کاربر فراهم می‌کند.
      * کلاس `.shape-tool.selected` رنگ پس‌زمینه و بردر متفاوتی را به ابزاری که در حال حاضر فعال است اعمال می‌کند.
      * کلاس `.canvas-area.drag-over` هنگامی که کاربر شکلی را روی بوم می‌کشد، بردر بوم را به یک خط‌چین تغییر می‌دهد و یک رنگ پس‌زمینه روشن اعمال می‌کند.
      * استایل‌های مکان‌نما به `grab` و `grabbing` روی ابزارهای قابل کشیدن تغییر می‌کند تا عملکرد آن‌ها را نشان دهد.
  * **آیکون‌های ابزار**: آیکون‌های اشکال در نوار کناری با CSS ایجاد شده‌اند. `.circle-icon` از `border-radius: 50%` استفاده می‌کند، `.square-icon` یک div استاندارد است، و `.triangle-icon` با استفاده از تکنیک بردر CSS ساخته شده است.

-----

## مدیریت وضعیت با `AppContext`

وضعیت برنامه در `AppContext.js` با استفاده از Context API در React متمرکز شده است تا از "prop drilling" (پاس دادن props از طریق چندین سطح از کامپوننت‌ها) جلوگیری شود. کامپوننت `AppProvider` یک شیء `contextValue` واحد را برای تمام کامپوننت‌های فرزند در دسترس قرار می‌دهد.

  * **State (`useState`)**:

      * `drawingName`: یک رشته برای عنوان نقاشی.
      * `selectedShapeTool`: یک رشته که نوع شکل انتخاب شده فعلی را نگه می‌دارد (`'circle'`, `'square'` و غیره)، یا `null`.
      * `shapesOnCanvas`: آرایه‌ای از اشیاء شکل، که هر شیء دارای `id`، `type`، `x` و `y` است.

  * **محاسبات بهینه‌سازی شده (`useMemo`)**:

      * `shapeCounts`: این مقدار از آرایه `shapesOnCanvas` مشتق می‌شود. از `useMemo` استفاده می‌شود تا اطمینان حاصل شود که منطق شمارش فقط زمانی اجرا می‌شود که آرایه `shapesOnCanvas` تغییر کند، که با جلوگیری از محاسبات مجدد غیرضروری در هر رندر، عملکرد را بهینه می‌کند.

  * **توابع بهینه‌سازی شده (`useCallback`)**:

      * تمام توابعی که وضعیت را تغییر می‌دهند (مانند `addShapeToCanvasOnClick`، `removeShapeFromCanvas`، `handleExport`) در `useCallback` پیچیده شده‌اند. این کار خود توابع را بهینه‌سازی (memoize) می‌کند و از رندر مجدد غیرضروری کامپوننت‌های فرزندی که به آنها وابسته‌اند، جلوگیری می‌کند، زمانی که کامپوننت والد به دلایل دیگری رندر می‌شود. این امر به ویژه برای عملکرد در برنامه‌های بزرگتر اهمیت دارد.
