# اپلیکیشن نقاشی با React JS

این یک اپلیکیشن نقاشی ساده مبتنی بر وب است که با **React** ساخته شده است. این اپلیکیشن یک canvas فراهم می‌کند که می‌توانن در آن اشکال هندسی پایه را اضافه، جابجا و حذف کنند. ویژگی‌های کلیدی شامل قابلیت نام‌گذاری نقاشی، شمارش تعداد اشکال استفاده شده، و خروجی گرفتن (export) یا import کردن کل نقاشی به عنوان یک فایل **JSON** است. وضعیت (state) برنامه به صورت متمرکز با استفاده از Context API در React مدیریت می‌شود.

## ویژگی‌ها

  * **ابزارهای شکل**: از یک جعبه ابزار حاوی **دایره**، **مربع** و **مثلث** برای افزودن به بوم انتخاب میکنیم.
  * **افزودن اشکال با کلیک**: پس از انتخاب یک ابزار از نوار کناری (sidebar)، با کلیک در هر جای بوم، شکل انتخاب شده در صفحه نقاشی اضافه می‌شود.
  * **افزودن اشکال با کشیدن و رها کردن (Drag-and-Drop)**: یک شکل را از نوار کنار میکشیم و روی بوم رها میکنیم تا یک شکل جدید در آن مکان ایجاد شود.
  * **حذف اشکال**: با دو بار کلیک بر روی هر شکل در بوم، آن شکل حذف خواهد شد.
  * **عنوان برای نقاشی**: یک ورودی متنی در هدر به ما امکان می‌دهد نقاشی خود را نام‌گذاری کنیم، که این نام همچنین به عنوان نام فایل برای خروجی‌ها استفاده می‌شود.
  * **خروجی گرفتن/Import کردن (Export/Import)**:
      * **خروجی**: کل نقاشی، شامل عنوان و تمام اشکال با ویژگی‌هایشان را در یک فایل `.json` ذخیره میکنیم.
      * **Import کردن**: یک فایل `.json` که قبلاً ذخیره شده است را برای بازیابی وضعیت برنامه بارگذاری میکنیم.
  * **شمارش اشکال**: فوتر (footer) تعداد هر نوع شکل موجود در بوم را به صورت زنده نمایش می‌دهد و با افزودن یا حذف اشکال به طور خودکار به‌روز می‌شود.
  * **چیدمان Responsive**: چیدمان برنامه با استفاده از CSS Flexbox ساخته شده است که به مل امکان می‌دهد با اندازه‌های مختلف صفحه نمایش سازگار شود.

-----

## ساختار پروژه

کد برنامه به صورت کامپوننت‌ها، یک context برای مدیریت وضعیت، و فایل‌های CSS برای استایل‌دهی ساختار دهی شده است. این تفکیک مسئولیت‌ها (separation of concerns) باعث می‌شود که کد ما ماژولار و قابل نگهداری‌ باشد.

```
src/
|-- components/
|   |-- Canvas.js        # ناحیه اصلی نقاشی.
|   |-- Footer.js        # نمایش تعداد اشکال.
|   |-- Header.js        # شامل عنوان و دکمه‌های export/import.
|   |-- Shape.js         # رندر کردن اشکال مجزا (دایره، مربع، مثلث).
|   |-- Sidebar.js       # جعبه ابزار برای انتخاب اشکال.
|-- context/
|   |-- AppContext.js    # مدیریت وضعیت کلی با استفاده از React Context.
|-- App.css              # استایل‌شیت اصلی برای چیدمان و کامپوننت‌های برنامه.
|-- App.js               
|-- index.css            
|-- index.js             # نقطه ورود برنامه React.
```

-----

## نوضیح کامپوننت‌ها

### `App`

کامپوننت اصلی App به عنوان ریشه (root) اپلیکیشن عمل می‌کند. وظیفه اصلی آن، ساختاردهی طرح کلی (layout) از طریق کنار هم قرار دادن کامپوننت‌های Header، Canvas، Sidebar و Footer است.

این کامپوننت، کل درخت کامپوننت‌ها (component tree) را درون AppProvider قرار می‌دهد (wrap می‌کند) و به این ترتیب، وضعیت (state) و اکشن‌های سراسری را در دسترس تمام کامپوننت‌های تو در تو (nested) قرار می‌دهد.

### `Header`

کامپوننت `Header` عنوان نقاشی را نمایش می‌دهد و قابلیت export/import را فراهم می‌کند.

  * **عنوان نقاشی**: یک فیلد `<input type="text">` به `drawingName` از state در context متصل شده است. event `onChange` تابع `setDrawingName` را برای به‌روزرسانی عنوان به صورت live فراخوانی می‌کند.
  * **دکمه Export**: کنترل‌کننده `onClick` دکمه "Export"، تابع `handleExport` را از context فراخوانی می‌کند. این تابع یک رشته JSON از `drawingName` و `shapesOnCanvas` فعلی ایجاد کرده، آن را در یک URL داده (data URL) می‌پیچد و به صورت برنامه‌ریزی شده روی یک عنصر موقت `<a>` کلیک می‌کند تا دانلود شروع شود.
  * **دکمه Import**: برای جلوگیری از نمایش یک عنصر ورودی فایل، دکمه "Import" از `useRef` برای کلیک برنامه‌ریزی شده روی یک `<input type="file">` مخفی استفاده می‌کند. هنگامی که یک فایل انتخاب می‌شود، رویداد `onChange` روی ورودی فایل، تابع `handleImport` را از context فراخوانی می‌کند که فایل JSON را می‌خواند، آن را تجزیه (parse) می‌کند و وضعیت برنامه را به‌روز می‌کند.

### `Sidebar`

 سایدبار `(Sidebar)` شامل ابزارهای مربوط به اشکال است که می‌توان آن‌ها را انتخاب کرده یا بکشد (drag کند).

  * انتخاب ابزار (Tool Selection)

هر ابزارِ شکل، یک تگ `<div>` با یک رویداد `onClick` است. این رویداد، تابع `setSelectedShapeTool` را از **context** فراخوانی کرده و وضعیت (`state`) مربوط به `selectedShapeTool` را به‌روز می‌کند. ابزاری که در حال حاضر انتخاب شده است، کلاس CSS به نام `selected` را برای بازخورد بصری به کاربر دریافت می‌کند.

  * کشیدن و رها کردن (Drag and Drop)

ابزارهای شکل با تنظیم ویژگی `draggable="true"`، **قابل کشیدن (draggable)** می‌شوند. رویداد `onDragStart` تابع `handleDragStart` را فراخوانی می‌کند. این تابع با استفاده از متد `event.dataTransfer.setData()`، **شناسه (ID)** شکل (مانند "circle") را به همراه یک شناسه نوع منحصر به فرد ذخیره می‌کند. این کار به **بوم نقاشی (Canvas)** امکان می‌دهد تا آیتم رها شده را شناسایی کند.

### `Canvas`

**بوم نقاشی (Canvas)** ناحیه‌ی تعاملی است که در آن اشکال رندر شده و دستکاری می‌شوند.

* **افزودن شکل (با کلیک)**: رویداد `onClick` تگ `<div>` اصلی بوم نقاشی (تابع `handleCanvasClickInternal`)، ابتدا بررسی می‌کند که آیا ابزار شکلی انتخاب شده است یا خیر، و سپس مختصات `x` و `y` محل کلیک را نسبت به بوم محاسبه می‌کند. در نهایت، تابع `addShapeToCanvasOnClick` را از **context** فراخوانی می‌کند تا شکل جدیدی ایجاد شود.

* **افزودن شکل (با رها کردن - Drop)**: رویداد `onDrop` (تابع `handleDrop`)، شناسه (ID) شکل را از متد `event.dataTransfer.getData()` بازیابی می‌کند. سپس، مختصات محل رها شدن را محاسبه کرده و تابع `addShapeFromDrop` را از **context** فراخوانی می‌کند تا شکل جدید به بوم اضافه شود. رویداد `onDragOver` نیز مدیریت می‌شود تا از رفتار پیش‌فرض مرورگر جلوگیری کرده و بازخورد بصری (از طریق کلاس `drag-over`) فراهم کند.

* **حذف اشکال**: کامپوننت `Canvas` روی آرایه `shapesOnCanvas` پیمایش (map) می‌کند و به ازای هر شکل، یک کامپوننت `Shape` را رندر می‌کند. این کامپوننت، تابع `removeShapeFromCanvas` را از **context** به طور مستقیم به `prop` مربوط به `onDoubleClick` در کامپوننت `Shape` ارسال می‌کند.

### `Footer`

کامپوننت **فوتر (Footer)** تعداد کل هر نوع شکل را نمایش می‌دهد. این کامپوننت آبجکت `shapeCounts` را از `AppContext` دریافت می‌کند.

این آبجکت به صورت بهینه در داخل **context** و با استفاده از هوک `useMemo` محاسبه می‌شود. این رویکرد تضمین می‌کند که شمارش‌ها فقط زمانی دوباره محاسبه شوند که آرایه `shapesOnCanvas` واقعاً تغییر کند.
### `Shape`

این کامپوننت مسئولیت رندر کردن یک شکل هندسی مجزا را بر اساس پراپ‌هایی (`props`) که دریافت می‌کند (مانند `id`, `type`, `x`, `y`) بر عهده دارد.

* برای موقعیت‌دهی (`positioning`) از **استایل‌های خطی (inline styles)** استفاده می‌کند (مانند `position: 'absolute'`, `left`, `top`).
* شکل هندسی و رنگ آن بر اساس پراپ `type` مشخص می‌شود. برای مثال، نوع `'circle'` (دایره) استایل `borderRadius: '50%'` می‌گیرد، در حالی که نوع `'triangle'` (مثلث) با استفاده از `border` های CSS ساخته می‌شود.
* با دو بار کلیک (double-click) بر روی `div` مربوط به شکل، تابع `onDoubleClick` که از کامپوننت `Canvas` به آن پاس داده شده، فعال می‌شود. این تابع در نهایت تابع `removeShapeFromCanvas` را از **context** فراخوانی می‌کند تا شکل مورد نظر حذف شود.

-----

## استایل‌دهی با `App.css`

ظاهر کلی اپلیکیشن در فایل `App.css` تعریف می‌شود. این فایل از **CSS Flexbox** برای ایجاد یک چیدمان (layout) واکنش‌گرا (responsive) و ساختاریافته استفاده می‌کند.

* **چیدمان کلی (Overall Layout)**: کلاس `.app-container` یک کانتینر flex عمودی ایجاد کرده و اپلیکیشن را به بخش‌های هدر (header)، محتوای اصلی (main content) و فوتر (footer) سازماندهی می‌کند. سپس، کلاس `.main-content` از یک چیدمان flex افقی برای قرار دادن `.canvas-area` و `.app-sidebar` در کنار یکدیگر استفاده می‌کند. ویژگی `flex-grow: 1` بر روی محتوای اصلی و بوم نقاشی اعمال شده تا اطمینان حاصل شود که این بخش‌ها تمام فضای موجود را اشغال می‌کنند.

* **استایل‌دهی کامپوننت‌ها (Component Styling)**: هر کدام از کامپوننت‌های اصلی مجموعه استایل‌های مخصوص به خود را دارند. برای مثال، `.app-header`، `.app-footer` و `.app-sidebar` دارای رنگ پس‌زمینه و حاشیه (border) مجزا هستند تا از نظر بصری از یکدیگر تفکیک شوند.

* **حالت‌های تعاملی (Interactive States)**: فایل CSS برای تعاملات کاربر بازخورد بصری فراهم می‌کند.
    * کلاس `.shape-tool.selected` یک رنگ پس‌زمینه و حاشیه متفاوت به ابزاری که در حال حاضر فعال است، اعمال می‌کند.
    * کلاس `.canvas-area.drag-over` هنگامی که کاربر شکلی را روی بوم نقاشی می‌کشد، حاشیه آن را به خط‌چین تغییر داده و یک رنگ پس‌زمینه روشن به آن اعمال می‌کند.
    * استایل‌های نشانگر ماوس (cursor) بر روی ابزارهای قابل کشیدن (draggable) به `grab` و `grabbing` تغییر می‌کند تا عملکرد آن‌ها را نشان دهد.

* **آیکون‌های ابزار (Tool Icons)**: آیکون‌های اشکال در سایدبار با CSS ساخته شده‌اند. آیکون دایره (`.circle-icon`) از `border-radius: 50%` استفاده می‌کند، آیکون مربع (`.square-icon`) یک `div` استاندارد است، و آیکون مثلث (`.triangle-icon`) با استفاده از تکنیک حاشیه (border) در CSS ساخته شده است.

-----

## مدیریت state با `AppContext`

وضعیت (state) اپلیکیشن در فایل `AppContext.js` و با استفاده از Context API در React متمرکز شده است تا از حالت **"prop drilling"** جلوگیری شود. کامپوننت `AppProvider` یک آبجکت واحد به نام `contextValue` را در دسترس تمام کامپوننت‌های فرزند قرار می‌دهد.

### **وضعیت یا State (با هوک `useState`)**

* `drawingName`: یک رشته (string) برای عنوان نقاشی.
* `selectedShapeTool`: یک رشته که نوع شکل انتخاب شده (`'circle'`, `'square'` و غیره) را نگه می‌دارد یا در صورت عدم انتخاب، مقدار آن `null` است.
* `shapesOnCanvas`: آرایه‌ای از آبجکت‌های شکل، که هر آبجکت دارای `id`، `type`، `x` و `y` است.

### **محاسبات Memoized (با هوک `useMemo`)**

* `shapeCounts`: این مقدار از آرایه `shapesOnCanvas` گرفته می‌شود. از `useMemo` استفاده شده تا منطق شمارش فقط زمانی اجرا شود که آرایه `shapesOnCanvas` تغییر کند. این کار با جلوگیری از محاسبات مجدد غیرضروری در هر رندر، عملکرد را بهینه می‌کند.

### **توابع بهینه‌سازی‌شده (با هوک `useCallback`)**

* تمام توابعی که وضعیت را تغییر می‌دهند (مانند `addShapeToCanvasOnClick`، `removeShapeFromCanvas` و `handleExport`) در `useCallback` پیچیده (wrap) شده‌اند. این کار خودِ توابع را **memoize** (بهینه‌سازی و ذخیره) می‌کند و از رندر مجدد و غیرضروری کامپوننت‌های فرزندی که به این توابع وابسته‌اند، جلوگیری می‌کند؛ به خصوص زمانی که کامپوننت والد به دلایل دیگری رندر مجدد می‌شود.

-----

## استفاده از AI

فقط برای کمک در استایل دهی استفاده شده است.
